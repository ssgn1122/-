<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì•„ë² ë¥´ì§€ì•ˆ ì „ìˆ  ì§€íœ˜ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        /* CSS ë³€ìˆ˜ë¥¼ í™œìš©í•œ ì „ì—­ í…Œë§ˆ ê´€ë¦¬ */
        :root {
            --void-dark: #05000a;
            --void-bg: #020617;
            --void-panel: rgba(15, 23, 42, 0.6);
            --void-purple: #581c87;
            --void-glow: #d8b4fe;
            --neon-blue: #0ea5e9;
            --neon-red: #f43f5e;
            --neon-green: #22c55e;
            --neon-yellow: #facc15;
            --cell-border: rgba(255, 255, 255, 0.05);
            --cell-hover: rgba(56, 189, 248, 0.3);
            --boss-glow-color: rgba(58, 0, 255, 0.5);
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: var(--void-dark); 
            color: #e2e8f0; 
            overflow-x: hidden; 
            margin: 0; 
            touch-action: manipulation;
        }

        /* === ìŠ¤í”Œë˜ì‹œ í™”ë©´ === */
        #splash-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: radial-gradient(circle at center, #1e1b4b 0%, var(--void-bg) 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        #splash-screen.hidden-splash { opacity: 0; visibility: hidden; transform: scale(1.1); filter: blur(10px); }

        .big-boss-svg { width: 300px; height: 380px; animation: float-boss 6s ease-in-out infinite; filter: drop-shadow(0 0 30px var(--boss-glow-color)); }
        @keyframes float-boss { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* === ë°°ê²½ ë° ìŠ¤ìº”ë¼ì¸ === */
        .cosmic-bg {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(76, 29, 149, 0.15) 0%, transparent 50%), 
                        radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.1) 0%, transparent 40%), 
                        radial-gradient(circle at 100% 100%, rgba(244, 63, 94, 0.1) 0%, transparent 40%);
            animation: nebula-pulse 10s infinite alternate;
        }
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 999;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px; animation: scanline 0.2s linear infinite; opacity: 0.15;
        }
        @keyframes nebula-pulse { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.1); opacity: 1; } }
        
        /* === íŒ¨ë„ ë° ê·¸ë¦¬ë“œ === */
        .glass-panel {
            background: var(--void-panel); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); border-radius: 8px; position: relative; overflow: hidden;
            transition: border-color 0.3s ease;
        }
        .glass-panel::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.5), transparent); }

        .void-grid-container { border: 1px solid rgba(139, 92, 246, 0.3); box-shadow: 0 0 50px rgba(88, 28, 135, 0.3); cursor: crosshair; }
        
        /* ê·¸ë¦¬ë“œ ì…€ (ìƒíƒœë¥¼ í´ë˜ìŠ¤ë¡œ ì œì–´í•˜ì—¬ ë¦¬í”Œë¡œìš° ë°©ì§€) */
        .void-cell { background: rgba(2, 6, 23, 0.8); border: 1px solid var(--cell-border); transition: all 0.3s ease; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .void-cell:hover { background: rgba(56, 189, 248, 0.1); border-color: var(--cell-hover); }

        .void-occupied {
            background: radial-gradient(circle at center, #000 20%, #2e1065 100%) !important; border: 1px solid #a855f7 !important;
            box-shadow: inset 0 0 30px var(--void-purple), 0 0 20px rgba(168, 85, 247, 0.6); animation: void-pulse 2s infinite alternate;
        }
        @keyframes void-pulse { from { box-shadow: inset 0 0 20px var(--void-purple); } to { box-shadow: inset 0 0 50px #a855f7, 0 0 10px var(--void-glow); } }

        .suggested-light { 
            box-shadow: inset 0 0 60px rgba(34, 197, 94, 0.3), 0 0 40px rgba(34, 197, 94, 0.8) !important; 
            border: 4px solid var(--neon-green) !important; z-index: 50; animation: target-pulse 0.8s infinite alternate;
        }
        @keyframes target-pulse { from { filter: brightness(1); transform: scale(1); } to { filter: brightness(1.3); transform: scale(0.98); } }
        
        .suggested-light::after { 
            content: 'ë‹¤ìŒ ëª©í‘œ'; position: absolute; top: 12px; left: 50%; transform: translateX(-50%); 
            font-size: 11px; font-weight: 900; color: #fff; background: var(--neon-green); padding: 2px 8px; border-radius: 4px;
            letter-spacing: 1px; text-shadow: 0 1px 3px rgba(0,0,0,0.5); font-family: 'Noto Sans KR'; z-index: 60; border: 1px solid rgba(255,255,255,0.4);
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }
        .number-label { position: absolute; font-family: 'Orbitron'; font-size: 3.5rem; font-weight: 900; color: rgba(255, 255, 255, 0.03); pointer-events: none; z-index: 0; }
        
        .cosmic-shell { border: 2px solid var(--neon-yellow) !important; }
        .shell-indicator { position: absolute; top: 8px; right: 8px; background: var(--neon-yellow); color: #000; font-size: 10px; font-weight: 900; padding: 2px 6px; border-radius: 4px; z-index: 30; }
        .soaking-mark { position: absolute; bottom: 10px; left: 10px; background: rgba(14, 165, 233, 0.9); color: #fff; font-size: 10px; font-weight: 900; padding: 3px 7px; border-radius: 4px; z-index: 30; border: 1px solid #fff; animation: soak-pulse 1.5s infinite; }
        @keyframes soak-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; box-shadow: 0 0 10px var(--neon-blue); } }

        /* === ë¯¸ë‹ˆ ë³´ìŠ¤ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì ìš© === */
        #boss-entity {
            position: absolute; width: 100px; height: 100px; z-index: 100; pointer-events: none; 
            transform: translate(-50%, -50%) scale(0.5); opacity: 0; visibility: hidden;
            /* ìœ„ì¹˜ ë³€ê²½ ì‹œ ë¶€ë“œëŸ½ê²Œ í™œì£¼í•˜ë„ë¡ cubic-bezier ì ìš© */
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        top 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.3s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), visibility 0.3s;
        }
        #boss-entity.active {
            opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1);
        }

        /* === ğŸ’€ ì „ë©¸(ë¹™ê³ ) ì‹œê° íš¨ê³¼ ê·¹ëŒ€í™” === */
        .death-cell {
            background: radial-gradient(circle at center, #be123c 0%, #4c0519 100%) !important;
            border: 2px solid var(--neon-red) !important;
            box-shadow: inset 0 0 60px var(--neon-red), 0 0 40px #e11d48 !important;
            animation: cell-death-pulse 0.3s infinite alternate !important;
            z-index: 40;
        }
        @keyframes cell-death-pulse {
            from { filter: brightness(1); transform: scale(1); }
            to { filter: brightness(1.5) contrast(1.2); transform: scale(0.96); }
        }

        .shake-hard { animation: shake-hard 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake-hard {
            0%, 100% { transform: translate3d(0, 0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate3d(-15px, 8px, 0) rotate(-1deg); }
            20%, 40%, 60%, 80% { transform: translate3d(15px, -8px, 0) rotate(1deg); }
        }

        .bingo-line { 
            position: absolute; background: #fff; 
            box-shadow: 0 0 30px var(--neon-red), 0 0 60px #e11d48, 0 0 90px #9f1239, inset 0 0 10px var(--neon-red); 
            z-index: 90; pointer-events: none; border-radius: 20px; 
            animation: slash-appear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes slash-appear {
            0% { opacity: 0; filter: brightness(4); transform: scale(0.1) var(--transform-base); }
            60% { opacity: 1; filter: brightness(2); transform: scale(1.05) var(--transform-base); }
            100% { opacity: 1; filter: brightness(1); transform: scale(1) var(--transform-base); }
        }

        #alert-layer { animation: fade-in-blood 0.8s ease-out forwards; }
        @keyframes fade-in-blood {
            0% { opacity: 0; backdrop-filter: blur(0px); background: rgba(0,0,0,0); }
            100% { opacity: 1; backdrop-filter: blur(20px); background: rgba(15,0,0,0.95); }
        }

        /* ê¸°íƒ€ ì• ë‹ˆë©”ì´ì…˜ */
        .floater { animation: float 2.5s ease-in-out infinite; }
        .pulsing-core { animation: pulse-core-anim 4s infinite alternate ease-in-out; transform-origin: center; }
        .mini-pulse { animation: mini-pulse-anim 1.5s infinite alternate ease-in-out; transform-origin: 128px 165px; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
        @keyframes pulse-core-anim { 0% { opacity: 0.7; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1.05); } }
        @keyframes mini-pulse-anim { 0% { opacity: 0.7; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1.1); } }
        .mode-active { background: var(--neon-blue) !important; color: white !important; box-shadow: 0 0 15px rgba(14, 165, 233, 0.6); }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col items-center justify-center">

    <!-- 1. ì¸íŠ¸ë¡œ ìŠ¤í”Œë˜ì‹œ í™”ë©´ (ARIA ì¶”ê°€ë¡œ ì ‘ê·¼ì„± í–¥ìƒ) -->
    <div id="splash-screen" role="button" aria-label="ì‹œìŠ¤í…œ ì‹œì‘í•˜ê¸°" tabindex="0">
        <svg class="big-boss-svg" viewBox="0 0 800 1000" role="img" aria-labelledby="boss-title boss-desc" xmlns="http://www.w3.org/2000/svg">
            <title id="boss-title">ì•„ë² ë¥´ì§€ì•ˆ ë©”ì¸ ì‹œìŠ¤í…œ ì½”ì–´</title>
            <desc id="boss-desc">ê±°ëŒ€í•œ ì¥ê°‘ê³¼ í‘¸ë¥¸ ì½”ì–´ë¥¼ ê°€ì§„ ë©”ì¹´ë‹‰ ë³´ìŠ¤ ì—”í‹°í‹°</desc>
            <defs>
              <linearGradient id="body_grad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#3a00ff"/><stop offset="40%" stop-color="#1c0080"/><stop offset="100%" stop-color="#0a0026"/></linearGradient>
              <radialGradient id="core_grad" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#00ffff"/><stop offset="30%" stop-color="#0066ff"/><stop offset="70%" stop-color="#110066" stop-opacity="0.5"/><stop offset="100%" stop-color="#110066" stop-opacity="0"/></radialGradient>
              <linearGradient id="armor" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="30%" stop-color="#a88022"/><stop offset="70%" stop-color="#543e0a"/><stop offset="100%" stop-color="#211702"/></linearGradient>
              <linearGradient id="armor_dark" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7a5c16"/><stop offset="100%" stop-color="#140f02"/></linearGradient>
              <filter id="glow" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="15" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
              <filter id="glow_soft" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
              <g id="right_armor_and_arm">
                <path d="M 430 360 C 520 380 540 450 540 550 C 540 640 510 680 490 650 C 470 580 460 480 430 450 Z" fill="url(#body_grad)"/>
                <path d="M 440 260 C 480 150 510 90 490 50 C 590 120 630 220 590 320 Z" fill="url(#armor_dark)" stroke="#1a1103" stroke-width="3"/>
                <path d="M 420 350 L 490 280 L 540 250 L 590 280 L 670 250 L 700 290 L 760 300 L 700 340 L 710 400 L 630 380 L 590 440 L 520 420 Z" fill="url(#armor)" stroke="#1a1103" stroke-width="4"/>
                <path d="M 400 350 L 460 380 L 440 430 L 480 480 L 440 530 L 420 570 L 400 560 Z" fill="url(#armor)" stroke="#1a1103" stroke-width="3"/>
                <path d="M 460 500 L 570 470 L 590 570 L 470 560 Z" fill="url(#armor)" stroke="#1a1103" stroke-width="3"/>
                <circle cx="560" cy="270" r="45" fill="#000000" stroke="#0044ff" stroke-width="12" filter="url(#glow)"/><circle cx="560" cy="270" r="30" fill="#000000" stroke="#00ffff" stroke-width="4" filter="url(#glow_soft)"/><circle cx="560" cy="270" r="20" fill="#000000"/>
              </g>
            </defs>
            <g opacity="0.9">
              <path d="M 400 300 C 450 300 480 450 490 600 C 500 750 580 880 700 900 C 740 910 750 960 650 970 C 500 990 300 990 150 970 C 50 960 60 910 100 900 C 220 880 300 750 310 600 C 320 450 350 300 400 300 Z" fill="url(#body_grad)"/>
              <path d="M 400 400 C 430 400 450 550 450 700 C 450 850 550 900 600 920 C 500 950 300 950 200 920 C 250 900 350 850 350 700 C 350 550 370 400 400 400 Z" fill="#260099" opacity="0.6" filter="url(#glow)"/>
            </g>
            <ellipse cx="400" cy="480" rx="60" ry="160" fill="url(#core_grad)" filter="url(#glow)"/>
            <ellipse cx="400" cy="480" rx="25" ry="100" fill="#ccffff" filter="url(#glow)" class="pulsing-core"/>
            <ellipse cx="400" cy="480" rx="10" ry="60" fill="#ffffff" filter="url(#glow_soft)"/>
            <use href="#right_armor_and_arm" /><use href="#right_armor_and_arm" transform="translate(800, 0) scale(-1, 1)" />
            <path d="M 360 270 L 400 240 L 440 270 L 420 300 L 380 300 Z" fill="url(#armor)" stroke="#1a1103" stroke-width="2"/>
            <path d="M 385 200 L 415 200 L 430 250 L 370 250 Z" fill="#0f0033"/>
            <circle cx="400" cy="225" r="25" fill="none" stroke="#0044ff" stroke-width="4" filter="url(#glow_soft)"/>
            <circle cx="400" cy="220" r="8" fill="#00ffff" filter="url(#glow)"/>
            <path d="M 400 150 L 410 200 L 390 200 Z" fill="url(#armor)"/><path d="M 400 180 L 440 160 L 420 200 Z" fill="url(#armor)"/><path d="M 400 180 L 360 160 L 380 200 Z" fill="url(#armor)"/>
        </svg>
        <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 tracking-tighter mt-4 orbitron">SYSTEM INITIALIZED</h1>
        <p class="text-indigo-300 tracking-[0.5em] text-xs font-bold mt-2 uppercase">ê³µí—ˆ í”„ë¡œí† ì½œ ê°€ë™ ì¤‘</p>
        <p class="text-white text-xs mt-12 animate-pulse font-bold orbitron uppercase" aria-hidden="true">CLICK TO DEPLOY MATRIX</p>
    </div>

    <div class="cosmic-bg" aria-hidden="true"></div>
    <div class="scanlines" aria-hidden="true"></div>

    <!-- 2. ë©”ì¸ UI ì»¨í…Œì´ë„ˆ -->
    <main class="max-w-7xl w-full mx-auto relative z-10 flex flex-col min-h-screen pt-4 pb-8">
        
        <!-- í—¤ë” ì˜ì—­ -->
        <header class="glass-panel p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-6 shrink-0">
            <div class="flex items-center gap-6">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-900 to-black border border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] flex items-center justify-center relative overflow-hidden" aria-hidden="true">
                    <svg viewBox="0 0 100 100" class="w-full h-full relative z-10 p-2"><circle cx="50" cy="50" r="40" fill="#000" stroke="#a855f7" stroke-width="4"/><circle cx="50" cy="50" r="20" fill="#0ea5e9" class="animate-pulse"/></svg>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 tracking-tighter drop-shadow-sm orbitron uppercase">AVERJIAN TACTICAL OS</h1>
                    <p class="text-[11px] text-indigo-200 uppercase tracking-[0.3em] font-bold mt-1">ê³„ì¸µì  ìœ„ìƒ ë™ê¸°í™” ì‘ì „ ì œì–´êµ­</p>
                </div>
            </div>
            
            <nav class="flex flex-wrap gap-2 justify-center" aria-label="ë‚œì´ë„ ë° ëª¨ë“œ ì„¤ì •">
                <button id="btn-normal" class="diff-btn text-xs px-4 py-3 bg-indigo-600 border border-indigo-500 text-white font-bold rounded" aria-pressed="true">ì¼ë°˜</button>
                <button id="btn-heroic" class="diff-btn text-xs px-4 py-3 bg-indigo-950/50 border border-indigo-800 text-indigo-300 font-bold rounded" aria-pressed="false">ì˜ì›…</button>
                <button id="btn-mythic" class="diff-btn text-xs px-4 py-3 bg-indigo-950/50 border border-indigo-800 text-indigo-300 font-bold rounded" aria-pressed="false">ì‹ í™”</button>
                <div class="w-px h-8 bg-white/10 mx-1" aria-hidden="true"></div>
                <button id="btn-mode-toggle" class="text-[10px] px-4 py-3 bg-slate-800 border border-slate-700 text-slate-300 font-bold rounded transition-all" aria-label="ì…ë ¥ ëª¨ë“œ ì „í™˜">ğŸ¯ íƒ€ì¼ ì ë ¹ ëª¨ë“œ</button>
                <button id="toggle-sound" class="text-xs px-3 py-3 bg-slate-800 border border-slate-700 text-slate-400 rounded" aria-label="ì†Œë¦¬ ì¼œê¸°/ë„ê¸°">ğŸ”Š</button>
            </nav>
        </header>

        <!-- ë©”ì¸ ì „ì¥ -->
        <section class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-6 flex-grow" aria-label="ì „ìˆ  ì‘ì „ ì˜ì—­">
            <div class="lg:col-span-7 xl:col-span-8 relative flex flex-col justify-center">
                <p id="instruction-text" class="absolute -top-6 left-0 text-[10px] text-indigo-300 tracking-widest font-bold uppercase" aria-live="polite">í´ë¦­: íƒ€ì¼ ì ë ¹ / ê¸¸ê²Œ ëˆ„ë¥´ê¸°: ë³´ìŠ¤ íŒŒí‚¹</p>
                
                <!-- ì „ìˆ  ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ -->
                <div id="grid-container" class="void-grid-container grid grid-cols-3 gap-1 aspect-square rounded-2xl overflow-hidden backdrop-blur-md relative transition-transform">
                    
                    <!-- ë³´ìŠ¤ ë§ˆì»¤ (CSS ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™) -->
                    <div id="boss-entity" role="img" aria-label="íŒŒí‚¹ëœ ë³´ìŠ¤ ìœ„ì¹˜">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="100%" height="100%">
                          <defs>
                            <linearGradient id="m_body_grad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#7b2cbf"/><stop offset="60%" stop-color="#3c096c"/><stop offset="100%" stop-color="#10002b"/></linearGradient>
                            <linearGradient id="m_armor" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ffea00"/><stop offset="50%" stop-color="#ffaa00"/><stop offset="100%" stop-color="#995c00"/></linearGradient>
                            <linearGradient id="m_armor_dark" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#cc8800"/><stop offset="100%" stop-color="#331a00"/></linearGradient>
                            <filter id="m_glow" x="-40%" y="-40%" width="180%" height="180%"><feGaussianBlur stdDeviation="3.5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            <g id="m_right_side">
                              <path d="M 135 90 L 165 35 L 180 70 Z" fill="url(#m_armor_dark)" stroke="#3a1c00" stroke-width="2" stroke-linejoin="round"/>
                              <path d="M 175 160 C 210 165, 215 195, 195 210 C 185 195, 175 185, 165 170 Z" fill="url(#m_body_grad)"/>
                              <path d="M 160 145 L 195 130 L 210 150 L 170 160 Z" fill="url(#m_armor)" stroke="#3a1c00" stroke-width="2.5" stroke-linejoin="round"/>
                              <path d="M 128 105 L 160 90 L 205 45 L 190 85 L 230 105 L 185 120 L 155 130 Z" fill="url(#m_armor)" stroke="#3a1c00" stroke-width="3" stroke-linejoin="round"/>
                              <circle cx="185" cy="65" r="14" fill="#000" stroke="#0055ff" stroke-width="4" filter="url(#m_glow)"/><circle cx="185" cy="65" r="5" fill="none" stroke="#00ffff" stroke-width="2"/>
                            </g>
                          </defs>
                          <g class="floater">
                            <path d="M 65 225 C 65 130, 90 95, 128 95 C 166 95, 191 130, 191 225 C 191 245, 150 235, 128 240 C 106 235, 65 245, 65 225 Z" fill="url(#m_body_grad)"/>
                            <ellipse cx="128" cy="165" rx="22" ry="35" fill="#00ffff" filter="url(#m_glow)" class="mini-pulse"/>
                            <ellipse cx="128" cy="165" rx="8" ry="20" fill="#ffffff" class="mini-pulse"/>
                            <use href="#m_right_side" /><use href="#m_right_side" transform="translate(256, 0) scale(-1, 1)" />
                            <path d="M 105 105 L 128 120 L 151 105 L 128 95 Z" fill="url(#m_armor)" stroke="#3a1c00" stroke-width="2"/>
                            <circle cx="128" cy="70" r="24" fill="#1b004a"/><circle cx="128" cy="70" r="24" fill="none" stroke="#5d2db8" stroke-width="2"/>
                            <!-- SMIL ì• ë‹ˆë©”ì´ì…˜ ëŒ€ì‹  CSS Keyframeì„ ë Œë”ë§ ìµœì í™”ì— ë§ê²Œ ì ìš©ëœ ìƒíƒœ -->
                            <ellipse cx="114" cy="72" rx="4" ry="7" fill="#00ffff" transform="rotate(20 114 72)" filter="url(#m_glow)"/><ellipse cx="142" cy="72" rx="4" ry="7" fill="#00ffff" transform="rotate(-20 142 72)" filter="url(#m_glow)"/>
                            <circle cx="114" cy="70" r="1.5" fill="#ffffff"/><circle cx="142" cy="70" r="1.5" fill="#ffffff"/>
                            <path d="M 128 25 L 116 55 L 140 55 Z" fill="url(#m_armor)" stroke="#3a1c00" stroke-width="2" stroke-linejoin="round"/><path d="M 128 35 L 128 50" stroke="#ffea00" stroke-width="2"/>
                          </g>
                        </svg>
                    </div>
                    <!-- ë¹™ê³  ìŠ¬ë˜ì‹œ ë¼ì¸ì´ ë“¤ì–´ê°ˆ ì»¨í…Œì´ë„ˆ -->
                    <div id="bingo-visual" class="absolute inset-0 pointer-events-none z-[70]" aria-hidden="true"></div>
                </div>
            </div>

            <div class="lg:col-span-5 xl:col-span-4 flex flex-col gap-4 mt-6 lg:mt-0">
                <div class="glass-panel flex flex-col items-center justify-center py-4 border-red-500/20 shadow-[0_0_30px_rgba(220,38,38,0.1)]" aria-live="polite" aria-atomic="true">
                    <p class="text-[11px] text-red-400 font-black mb-1 tracking-[0.3em] uppercase">í˜„ì¬ ì „ë©¸ ìœ„í˜‘ ì§€ìˆ˜</p>
                    <p id="stat-max-line" class="text-6xl font-black text-red-500 tracking-tighter orbitron glitch-text" data-text="0%">0%</p>
                </div>
                
                <div id="suggest-card" class="glass-panel flex flex-col items-center justify-center py-3 border-indigo-500/30" aria-live="polite" aria-atomic="true">
                    <p class="text-[10px] text-indigo-300 font-black mb-1 tracking-[0.2em] text-center uppercase">ìµœì  ì „ìˆ  ì´ë™ ê²½ë¡œ</p>
                    <p id="stat-suggested" class="text-5xl font-black text-slate-400 transition-all italic orbitron mb-1 text-center">ëŒ€ê¸°</p>
                    <div class="px-4 py-1 bg-indigo-950/80 rounded border border-indigo-700/50 w-4/5 text-center">
                        <p id="suggest-subtitle" class="text-[10px] font-bold tracking-wider text-indigo-300 transition-colors">ì…ë ¥ ëŒ€ê¸° ì¤‘</p>
                    </div>
                </div>

                 <div class="glass-panel p-5 flex flex-col justify-center gap-4 flex-grow" aria-live="polite">
                    <div class="flex justify-between items-end border-b border-white/5 pb-2">
                        <span class="text-[11px] text-slate-400 tracking-widest font-bold uppercase">í˜„ì¬ ì´ ê°€ì¤‘ì¹˜ í•©ê³„</span>
                        <span id="stat-total-weight" class="text-xl font-black text-white orbitron">0 / 14</span>
                    </div>
                    <div class="grid grid-cols-1 gap-3 mt-1" aria-hidden="true">
                        <div class="flex justify-between items-center p-2.5 bg-cyan-950/30 border border-cyan-800/40 rounded-lg">
                            <div class="flex flex-col">
                                <span class="text-cyan-400 font-black text-xs">1ìˆœìœ„: ë³€ êµ¬ì—­ (Side)</span>
                                <span class="text-[10px] text-slate-400">#2, #4, #6, #8 íƒ€ì¼</span>
                            </div>
                            <span class="text-cyan-400 font-black orbitron text-lg">2</span>
                        </div>
                        <div class="flex justify-between items-center p-2.5 bg-purple-950/30 border border-purple-800/40 rounded-lg">
                            <div class="flex flex-col">
                                <span class="text-purple-400 font-black text-xs">2ìˆœìœ„: ëª¨ì„œë¦¬ êµ¬ì—­ (Corner)</span>
                                <span class="text-[10px] text-slate-400">#1, #3, #7, #9 íƒ€ì¼</span>
                            </div>
                            <span class="text-purple-400 font-black orbitron text-lg">3</span>
                        </div>
                        <div class="flex justify-between items-center p-2.5 bg-yellow-950/30 border border-yellow-800/40 rounded-lg">
                            <div class="flex flex-col">
                                <span class="text-yellow-400 font-black text-xs">3ìˆœìœ„: ì¤‘ì•™ êµ¬ì—­ (Center)</span>
                                <span class="text-[10px] text-slate-400">#5 íƒ€ì¼ (ìµœí›„ì˜ ë³´ë£¨)</span>
                            </div>
                            <span class="text-yellow-400 font-black orbitron text-lg">4</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- í•˜ë‹¨ ê°€ì´ë“œ ë°” -->
        <footer class="glass-panel p-4 mb-6 border-l-4 border-cyan-500 flex flex-col md:flex-row gap-4 items-center shrink-0">
            <div class="flex items-center gap-3 w-full md:w-auto justify-center border-b md:border-b-0 md:border-r border-white/10 pb-3 md:pb-0 md:pr-6 shrink-0" aria-hidden="true">
                <span class="text-2xl animate-pulse">ğŸ’¡</span>
                <h3 class="font-bold text-cyan-400 text-sm tracking-widest uppercase whitespace-nowrap">í•µì‹¬ ì§€íœ˜ ê°€ì´ë“œ</h3>
            </div>
            <div class="text-[11px] text-slate-300 leading-relaxed text-center md:text-left flex-grow">
                <strong class="text-cyan-300">1ë‹¨ê³„: Sides ìš°ì„  ì ë ¹</strong> | <strong class="text-purple-300">2ë‹¨ê³„: Corners ê¸°ë™</strong> | <strong class="text-yellow-300">3ë‹¨ê³„: CenterëŠ” ê°€ì¤‘ì¹˜ 14 ì´ìƒì¼ ë•Œ</strong>
                <span class="text-indigo-300 block mt-1 bg-indigo-950/40 p-1.5 rounded border border-indigo-900/30" id="diff-objective" aria-live="polite">ì‘ì „ ëª©í‘œ ë¶„ì„ ì¤‘...</span>
            </div>
        </footer>

        <div class="flex gap-4 shrink-0">
            <button id="btn-reset" class="flex-1 py-5 bg-red-950/30 border border-red-900/50 text-red-400 text-xs font-black tracking-[0.2em] rounded orbitron uppercase transition-all hover:bg-red-900/50 hover:border-red-500 shadow-lg" aria-label="ì „ì¥ ì´ˆê¸°í™”">RESET AREA</button>
            <button id="btn-title" class="flex-1 py-5 bg-indigo-950/30 border border-indigo-900/50 text-indigo-300 text-xs font-black tracking-[0.2em] rounded orbitron uppercase transition-all hover:bg-indigo-900/50 hover:border-indigo-500 shadow-lg" aria-label="íƒ€ì´í‹€ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°">BACK TO TITLE</button>
        </div>
    </main>

    <!-- ì „ë©¸ ì˜¤ë²„ë ˆì´ (ì‹œê° íš¨ê³¼ ê°•í™”) -->
    <div id="alert-layer" class="fixed inset-0 bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center z-[100] hidden p-10 text-center" role="alert" aria-live="assertive">
        <h2 class="text-7xl md:text-9xl font-black text-red-600 mb-4 orbitron italic drop-shadow-[0_0_50px_rgba(220,38,38,0.8)] glitch-text" data-text="WIPED">WIPED</h2>
        <p class="text-red-300 mb-14 font-bold tracking-[0.4em] text-sm border-y border-red-900/50 py-4 px-12 bg-red-950/30 uppercase">Protocol Failed: Critical Mass Reached</p>
        <button id="btn-reboot" class="px-16 py-6 bg-white text-black font-black text-xl orbitron rounded transition-transform hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)]">REBOOT SYSTEM</button>
    </div>

    <script>
        const CELL_SIZE = 100 / 3;
        let audioCtx = null;
        let soundEnabled = true;
        let currentMode = 'tile'; 
        let touchTimer = null; 

        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ë° ì‚¬ìš´ë“œ ë°œìƒ ë¡œì§
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playComplexSound(type) {
            if (!soundEnabled) return;
            initAudio();
            const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            switch(type) {
                case 'start': osc.type='triangle'; osc.frequency.setValueAtTime(150, now); osc.frequency.exponentialRampToValueAtTime(400, now+0.3); gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.5); osc.start(now); osc.stop(now+0.5); break;
                case 'place_boss': osc.type='sawtooth'; osc.frequency.setValueAtTime(80, now); osc.frequency.exponentialRampToValueAtTime(40, now+0.2); gain.gain.setValueAtTime(0.15, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.2); osc.start(now); osc.stop(now+0.2); break;
                case 'toggle_on': osc.type='sine'; osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(400, now+0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.15); osc.start(now); osc.stop(now+0.15); break;
                case 'toggle_off': osc.type='sine'; osc.frequency.setValueAtTime(200, now); osc.frequency.linearRampToValueAtTime(150, now+0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.15); osc.start(now); osc.stop(now+0.15); break;
                case 'break_shell': osc.type='square'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(100, now+0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.1); osc.start(now); osc.stop(now+0.1); break;
                case 'bingo': osc.type='sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.linearRampToValueAtTime(50, now+0.8); gain.gain.setValueAtTime(0.4, now); gain.gain.linearRampToValueAtTime(0.01, now+0.8); osc.start(now); osc.stop(now+0.8); break;
                case 'ui_click': osc.type='sine'; osc.frequency.setValueAtTime(500, now); gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.1); osc.start(now); osc.stop(now+0.1); break;
            }
        }

        const container = document.getElementById('grid-container'), 
              bingoVisual = document.getElementById('bingo-visual'), 
              bossEntity = document.getElementById('boss-entity'), 
              statTotalWeight = document.getElementById('stat-total-weight'), 
              statMaxLine = document.getElementById('stat-max-line'), 
              statSuggested = document.getElementById('stat-suggested'), 
              suggestCard = document.getElementById('suggest-card'), 
              suggestSubtitle = document.getElementById('suggest-subtitle'), 
              diffObjective = document.getElementById('diff-objective'), 
              overlay = document.getElementById('alert-layer');
        
        let currentDiff = 'normal', bossCoord = null, cells = Array(9).fill(null).map(() => ({ occupied: false, shell: 0 }));
        const WEIGHTS =[3, 2, 3, 2, 4, 2, 3, 2, 3], LINES = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        
        // DOM ìš”ì†Œ ì´ˆê¸° 1íšŒ ìƒì„± (ë¦¬í”Œë¡œìš° ë°©ì§€)
        function initGridDOM() {
            for (let i = 0; i < 9; i++) { 
                const div = document.createElement('div'); 
                div.className = 'void-cell'; 
                div.setAttribute('role', 'button');
                div.setAttribute('aria-label', `êµ¬ì—­ ${i + 1}`);
                
                const numSpan = document.createElement('span'); 
                numSpan.className = 'number-label'; 
                numSpan.innerText = i + 1; 
                div.appendChild(numSpan);
                
                const shellSpan = document.createElement('span'); 
                shellSpan.className = 'shell-indicator'; 
                shellSpan.style.display = 'none'; 
                div.appendChild(shellSpan);
                
                const soakSpan = document.createElement('span'); 
                soakSpan.className = 'soaking-mark'; 
                soakSpan.innerText = 'ì‚°ê°œ êµ¬ì—­'; 
                soakSpan.style.display = 'none'; 
                div.appendChild(soakSpan);
                
                // ë³´ìŠ¤ ì—”í‹°í‹° ì•ì— íƒ€ì¼ ì¶”ê°€
                container.insertBefore(div, bossEntity); 
            } 
        }

        function getGridDist(idx1, idx2) {
            const x1 = idx1 % 3, y1 = Math.floor(idx1 / 3), x2 = idx2 % 3, y2 = Math.floor(idx2 / 3);
            return Math.hypot(x1 - x2, y1 - y2);
        }

        function calculateStrategy() {
            let total = 0; 
            cells.forEach((c, i) => { if (c.occupied) total += WEIGHTS[i]; }); 
            statTotalWeight.innerText = `${total} / 14`;
            
            let maxLineCount = 0; 
            let hasAny = cells.some(c => c.occupied);
            LINES.forEach(line => { 
                const count = line.filter(idx => cells[idx].occupied).length; 
                if (count > maxLineCount) maxLineCount = count; 
            });
            statMaxLine.innerText = Math.round((maxLineCount / 3) * 100) + "%";
            statMaxLine.setAttribute('data-text', statMaxLine.innerText);
            
            if (!hasAny || !bossCoord) { 
                resetSuggestUI("ëŒ€ê¸°", "text-slate-500", "slate", "ì‘ì „ ì§€ì‹œ ëŒ€ê¸° ì¤‘"); 
                return { status: 'wait', idxs:[] }; 
            }
            
            const bx = Math.min(Math.floor(bossCoord.x / CELL_SIZE), 2), 
                  by = Math.min(Math.floor(bossCoord.y / CELL_SIZE), 2), 
                  bossIdx = by * 3 + bx;
            const isBingoThreatened = (target) => { 
                for (let line of LINES) { 
                    if (line.includes(target) && line.filter(idx => cells[idx].occupied).length === 2 && !cells[target].occupied) return true; 
                } 
                return false; 
            };
            
            let bestSideIdxs = [], minSideDist = Infinity;
            for (let idx of[1, 3, 5, 7]) { 
                if (cells[idx].occupied || isBingoThreatened(idx)) continue; 
                const dist = getGridDist(bossIdx, idx); 
                if (dist < minSideDist - 0.001) { minSideDist = dist; bestSideIdxs =[idx]; } 
                else if (Math.abs(dist - minSideDist) < 0.001) { bestSideIdxs.push(idx); } 
            }
            if (bestSideIdxs.length > 0) { 
                resetSuggestUI(bestSideIdxs.map(i => `#${i + 1}`).join(', '), "text-cyan-400", "cyan", "ìµœì : ì¸ì ‘ ë³€ êµ¬ì—­ ìš°ì„  í™•ë³´"); 
                return { status: 'success', idxs: bestSideIdxs }; 
            }
            
            let bestCornerIdxs =[], minCornerDist = Infinity;
            for (let idx of [0, 2, 6, 8]) { 
                if (cells[idx].occupied || isBingoThreatened(idx)) continue; 
                const dist = getGridDist(bossIdx, idx); 
                if (dist < minCornerDist - 0.001) { minCornerDist = dist; bestCornerIdxs = [idx]; } 
                else if (Math.abs(dist - minCornerDist) < 0.001) { bestCornerIdxs.push(idx); } 
            }
            if (bestCornerIdxs.length > 0) { 
                resetSuggestUI(bestCornerIdxs.map(i => `#${i + 1}`).join(', '), "text-purple-400", "purple", "ì°¨ì„ : ì¸ì ‘ ëª¨ì„œë¦¬ ìš°íšŒ ê¸°ë™"); 
                return { status: 'success', idxs: bestCornerIdxs }; 
            }
            
            if (!cells[4].occupied && (total >= 14 || isBingoThreatened(4))) { 
                resetSuggestUI("#5", "text-yellow-400", "yellow", "ìœ„ê¸‰: ì¤‘ì•™ ë°©ì–´ì„  ì¦‰ì‹œ ì „ê°œ"); 
                return { status: 'success', idxs: [4] }; 
            }
            resetSuggestUI("ìœ„í—˜", "text-red-500", "red", "ê²½ê³ : ëª¨ë“  ì•ˆì „ ê¶¤ë„ ê³ ê°ˆ"); 
            return { status: 'danger', idxs:[] };
        }

        function resetSuggestUI(text, textClass, colorName, subText) {
            statSuggested.innerText = text; 
            let fontSize = text.length > 8 ? 'text-3xl' : text.length > 4 ? 'text-4xl' : 'text-5xl';
            statSuggested.className = `${fontSize} font-black orbitron mb-1 transition-all ${textClass}`;
            suggestCard.style.borderColor = `var(--neon-${colorName === 'slate' ? 'blue' : colorName})`;
            suggestSubtitle.innerText = subText;
            suggestSubtitle.className = `text-[10px] font-bold tracking-wider text-${colorName === 'slate' ? 'indigo' : colorName}-300 transition-colors duration-300`;
        }

        // ìƒíƒœ ë°ì´í„° ê°±ì‹  í›„ ì‹œê° íš¨ê³¼ ì—…ë°ì´íŠ¸ í˜¸ì¶œ
        function processInput(xPercent, yPercent, isBoss) {
            if (isBoss) {
                bossCoord = { x: xPercent, y: yPercent };
                bossEntity.classList.add('active');
                // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ CSS inline styleë¡œ ì¢Œí‘œê°’ ì „ë‹¬
                bossEntity.style.left = `${xPercent}%`; 
                bossEntity.style.top = `${yPercent}%`;
                playComplexSound('place_boss');
            } else {
                const col = Math.min(Math.floor(xPercent / CELL_SIZE), 2), 
                      row = Math.min(Math.floor(yPercent / CELL_SIZE), 2), 
                      idx = row * 3 + col; 
                if (idx >= 0 && idx < 9) { 
                    if (currentDiff === 'mythic' && !cells[idx].occupied && cells[idx].shell > 0) { 
                        cells[idx].shell--; 
                        playComplexSound('break_shell'); 
                    } else { 
                        cells[idx].occupied = !cells[idx].occupied; 
                        cells[idx].shell = (cells[idx].occupied ? 0 : (currentDiff === 'mythic' ? 2 : 0)); 
                        playComplexSound(cells[idx].occupied ? 'toggle_on' : 'toggle_off'); 
                    }
                } 
            }
            updateGridVisuals();
        }

        function handleInteraction(e) {
            e.preventDefault();
            const rect = container.getBoundingClientRect();
            let clientX, clientY, isRightClick = e.button === 2;
            if (e.type.startsWith('touch')) { 
                clientX = e.touches[0].clientX; clientY = e.touches[0].clientY; 
            } else { 
                clientX = e.clientX; clientY = e.clientY; 
            }
            const x = ((clientX - rect.left) / rect.width) * 100, 
                  y = ((clientY - rect.top) / rect.height) * 100;

            if (e.type === 'mousedown') { 
                if (isRightClick) processInput(x, y, true); 
                else if (currentMode === 'boss') processInput(x, y, true); 
                else processInput(x, y, false); 
            } 
            else if (e.type === 'touchstart') { 
                touchTimer = setTimeout(() => { processInput(x, y, true); touchTimer = null; }, 500); 
            }
            else if (e.type === 'touchend') { 
                if (touchTimer) { 
                    clearTimeout(touchTimer); 
                    if (currentMode === 'boss') processInput(x, y, true); 
                    else processInput(x, y, false); 
                } 
            }
        }

        function setDifficulty(d) { 
            currentDiff = d; playComplexSound('ui_click');
            document.querySelectorAll('.diff-btn').forEach(btn => { 
                const mode = btn.id.replace('btn-', ''); 
                btn.setAttribute('aria-pressed', mode === d);
                btn.className = `diff-btn text-xs px-4 py-3 font-bold rounded tracking-widest transition-all ${mode === d ? 'bg-indigo-600 border border-indigo-500 text-white shadow-[0_0_15px_rgba(79,70,229,0.5)]' : 'bg-indigo-950/50 border border-indigo-800 text-indigo-300 hover:bg-indigo-600 hover:text-white'}`; 
            });
            diffObjective.innerHTML = d === 'normal' ? "[ì¼ë°˜] ê¸°ë³¸ ë¹™ê³  íšŒí”¼ ë° ì „ìˆ ì  ê³µê°„ í™•ë³´" : 
                                      d === 'heroic' ? "[ì˜ì›…] ì™¸ê³½ ê¶¤ë„ ìˆœí™˜ ë° <strong class='text-white'>ì‚°ê°œ(Soaking) ê³µê°„</strong> í™•ë³´" : 
                                      "[ì‹ í™”] <strong class='text-white'>ìš°ì£¼ ë³´í˜¸ë§‰(Shell)</strong> ë¶„ì‚° í•´ì œ ë° íŒŒí‚¹ ì—„ìˆ˜";
            resetAll(false); 
        }
        
        // DOM ì¬ì„¤ì • ì—†ì´ í´ë˜ìŠ¤ì™€ ì†ì„±ë§Œ í† ê¸€í•˜ëŠ” ìµœì í™”ëœ ì‹œê° íš¨ê³¼ í•¨ìˆ˜
        function updateGridVisuals() {
            const strategyObj = calculateStrategy();
            const bestIdxs = strategyObj.status === 'success' ? strategyObj.idxs :[];
            const cellElements = container.querySelectorAll('.void-cell');
            
            cellElements.forEach((div, i) => {
                const cellData = cells[i];
                const isBest = bestIdxs.includes(i);
                
                div.classList.toggle('void-occupied', cellData.occupied);
                div.classList.toggle('cosmic-shell', currentDiff === 'mythic' && !cellData.occupied && cellData.shell > 0);
                div.classList.toggle('suggested-light', isBest && !cellData.occupied);
                
                const sInd = div.querySelector('.shell-indicator');
                const soakInd = div.querySelector('.soaking-mark');
                
                if (currentDiff === 'mythic' && !cellData.occupied && cellData.shell > 0) { 
                    sInd.style.display = 'block'; 
                    sInd.innerText = `ë³´í˜¸ë§‰:${cellData.shell}`; 
                } else {
                    sInd.style.display = 'none';
                }
                
                if (currentDiff === 'heroic' && !cellData.occupied && !isBest) {
                    soakInd.style.display = 'block'; 
                } else {
                    soakInd.style.display = 'none';
                }
            });
            checkBingo();
        }

        function checkBingo() {
            bingoVisual.innerHTML = ''; 
            const allCells = container.querySelectorAll('.void-cell');
            const win = LINES.find(l => l.every(idx => cells[idx].occupied));
            
            if (win) {
                playComplexSound('bingo');
                
                win.forEach(idx => {
                    allCells[idx].classList.add('death-cell');
                });

                container.classList.add('shake-hard');
                
                const line = document.createElement('div'); 
                line.className = 'bingo-line';
                
                const f = win[0], l = win[2];
                const isH = Math.floor(f/3) === Math.floor(l/3);
                const isV = f%3 === l%3;
                
                if (isH) {
                    const top = Math.floor(f/3) * CELL_SIZE + (CELL_SIZE / 2);
                    line.style.cssText = `width: 100%; height: 16px; top: ${top}%; left: 0; --transform-base: translateY(-50%); transform: translateY(-50%);`;
                } else if (isV) {
                    const left = (f%3) * CELL_SIZE + (CELL_SIZE / 2);
                    line.style.cssText = `width: 16px; height: 100%; left: ${left}%; top: 0; --transform-base: translateX(-50%); transform: translateX(-50%);`;
                } else {
                    const deg = f === 0 ? 45 : -45;
                    line.style.cssText = `width: 145%; height: 16px; top: 50%; left: 50%; --transform-base: translate(-50%, -50%) rotate(${deg}deg); transform: translate(-50%, -50%) rotate(${deg}deg);`;
                }
                
                bingoVisual.appendChild(line); 
                setTimeout(() => overlay.classList.remove('hidden'), 800);
            }
        }

        function resetAll(playSound = true) { 
            if(playSound) playComplexSound('ui_click');
            cells = Array(9).fill(null).map(() => ({ occupied: false, shell: currentDiff === 'mythic' ? 2 : 0 })); 
            bossCoord = null; 
            bossEntity.classList.remove('active'); 
            bingoVisual.innerHTML = ''; 
            overlay.classList.add('hidden'); 
            container.classList.remove('shake-hard');
            container.querySelectorAll('.void-cell').forEach(c => c.classList.remove('death-cell'));
            updateGridVisuals(); 
        }

        function toggleMode() {
            currentMode = currentMode === 'tile' ? 'boss' : 'tile';
            const btn = document.getElementById('btn-mode-toggle');
            btn.innerText = currentMode === 'tile' ? 'ğŸ¯ íƒ€ì¼ ì ë ¹ ëª¨ë“œ' : 'ğŸ‘¾ ë³´ìŠ¤ íŒŒí‚¹ ëª¨ë“œ';
            btn.classList.toggle('mode-active', currentMode === 'boss');
            document.getElementById('instruction-text').innerText = currentMode === 'tile' ? 'í´ë¦­: íƒ€ì¼ ì ë ¹ / ê¸¸ê²Œ ëˆ„ë¥´ê¸°: ë³´ìŠ¤ íŒŒí‚¹' : 'í´ë¦­: ë³´ìŠ¤ íŒŒí‚¹ / ê¸¸ê²Œ ëˆ„ë¥´ê¸°: íƒ€ì¼ ì ë ¹';
            playComplexSound('ui_click');
        }

        function hideSplash() { playComplexSound('start'); document.getElementById('splash-screen').classList.add('hidden-splash'); setTimeout(() => { document.getElementById('splash-screen').style.display = 'none'; }, 800); }
        function showSplash() { playComplexSound('ui_click'); const splash = document.getElementById('splash-screen'); splash.style.display = 'flex'; setTimeout(() => { splash.classList.remove('hidden-splash'); }, 10); resetAll(false); }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”©
        document.getElementById('splash-screen').addEventListener('click', hideSplash);
        document.getElementById('splash-screen').addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') hideSplash(); });
        document.getElementById('btn-mode-toggle').addEventListener('click', toggleMode);
        document.getElementById('btn-normal').addEventListener('click', () => setDifficulty('normal'));
        document.getElementById('btn-heroic').addEventListener('click', () => setDifficulty('heroic'));
        document.getElementById('btn-mythic').addEventListener('click', () => setDifficulty('mythic'));
        document.getElementById('btn-reset').addEventListener('click', () => resetAll(true));
        document.getElementById('btn-title').addEventListener('click', showSplash);
        document.getElementById('btn-reboot').addEventListener('click', () => resetAll(true));
        document.getElementById('toggle-sound').addEventListener('click', () => { soundEnabled = !soundEnabled; document.getElementById('toggle-sound').innerText = soundEnabled ? "ğŸ”Š" : "ğŸ”‡"; });

        container.addEventListener('mousedown', handleInteraction);
        container.addEventListener('touchstart', handleInteraction, { passive: false });
        container.addEventListener('contextmenu', (e) => e.preventDefault());
        container.addEventListener('touchend', (e) => {
            if (touchTimer) { clearTimeout(touchTimer); const rect = container.getBoundingClientRect(); let clientX = e.changedTouches[0].clientX, clientY = e.changedTouches[0].clientY; const x = ((clientX - rect.left) / rect.width) * 100, y = ((clientY - rect.top) / rect.height) * 100; if (currentMode === 'boss') processInput(x, y, true); else processInput(x, y, false); }
        });
        
        // ì•± ì´ˆê¸°í™” ë¡œì§
        initGridDOM();
        setDifficulty('normal');
    </script>
</body>
</html>